<!DOCTYPE html>
<html>
<head>
    <title>Policy PDF Download</title>
</head>
<body style="font-family: Arial; text-align:center; padding-top:50px;">

<h2>Your policy is being prepared...</h2>
<p>Please wait, your PDF will download automatically.</p>

<script>
// 1Ô∏è‚É£ Read policyid from URL
const urlParams = new URLSearchParams(window.location.search);
const policyId = urlParams.get("policyid");

if (!policyId) {
    document.body.innerHTML = "<h2>‚ùå Invalid Request: Policy ID Missing</h2>";
}

// 2Ô∏è‚É£ API URL that returns PDF URL
const apiUrl = `http://localhost:8000/api/Policy_renewal/get_pdf_path?policyid=${policyId}`;

(async () => {
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (!data.success) {
            document.body.innerHTML = "<h2>‚ùå Failed to generate PDF</h2>";
            return;
        }

        const pdfUrl = data.pdfUrl;

        // 3Ô∏è‚É£ OPEN PDF in NEW TAB
        window.open(pdfUrl, "_blank");

        // 4Ô∏è‚É£ Show message on this page
        document.body.innerHTML = `
            <h2>üìÑ Your PDF is opened in a new tab</h2>
            <p>If it didn't open, <a href="${pdfUrl}" target="_blank">CLICK HERE</a></p>
        `;

    } catch (err) {
        document.body.innerHTML = "<h2>‚ùå Error fetching policy PDF</h2>";
    }
})();
</script>

</body>
</html>
